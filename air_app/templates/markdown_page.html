{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}
{% block description %}{{ description }}{% endblock %}

{% block head %}
<style>
    /* Enhanced styling for markdown content */
    .markdown-content {
        @apply prose max-w-none prose-headings:text-primary prose-a:text-primary;
    }
    
    .markdown-content h1 {
        @apply text-4xl font-bold mb-6 mt-8 text-primary;
    }
    
    .markdown-content h2 {
        @apply text-3xl font-bold mb-4 mt-8 text-primary border-b pb-2;
    }
    
    .markdown-content h3 {
        @apply text-2xl font-bold mb-3 mt-6 text-primary;
    }
    
    .markdown-content p {
        @apply my-4 text-base-content;
    }
    
    .markdown-content ul {
        @apply list-disc pl-6 my-4;
    }
    
    .markdown-content ol {
        @apply list-decimal pl-6 my-4;
    }
    
    .markdown-content li {
        @apply mb-2;
    }
    
    .markdown-content blockquote {
        @apply border-l-4 border-primary pl-4 italic my-4;
    }
    
    .markdown-content pre {
        @apply bg-base-200 p-4 rounded-lg my-4 overflow-x-auto;
    }
    
    .markdown-content code {
        @apply bg-base-200 px-1 py-0.5 rounded text-sm;
    }
    
    .markdown-content pre code {
        @apply bg-transparent p-0;
    }
    
    /* Syntax highlighting */
    .highlight .hll { background-color: #ffffcc }
    .highlight .c { color: #888888; font-style: italic } /* Comment */
    .highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
    .highlight .k { color: #008800; font-weight: bold } /* Keyword */
    .highlight .n { color: #555555 } /* Name */
    .highlight .o { color: #555555 } /* Operator */
    .highlight .p { color: #555555 } /* Punctuation */
    .highlight .ch { color: #888888; font-style: italic } /* Comment.Hashbang */
    .highlight .cm { color: #888888; font-style: italic } /* Comment.Multiline */
    .highlight .cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
    .highlight .cpf { color: #888888; font-style: italic } /* Comment.PreprocFile */
    .highlight .c1 { color: #888888; font-style: italic } /* Comment.Single */
    .highlight .cs { color: #cc0000; font-weight: bold; font-style: italic } /* Comment.Special */
    .highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
    .highlight .ge { font-style: italic } /* Generic.Emph */
    .highlight .gr { color: #aa0000 } /* Generic.Error */
    .highlight .gh { color: #333333 } /* Generic.Heading */
    .highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
    .highlight .go { color: #888888 } /* Generic.Output */
    .highlight .gp { color: #555555 } /* Generic.Prompt */
    .highlight .gs { font-weight: bold } /* Generic.Strong */
    .highlight .gu { color: #666666 } /* Generic.Subheading */
    .highlight .gt { color: #aa0000 } /* Generic.Traceback */
    .highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
    .highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
    .highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
    .highlight .kp { color: #008800 } /* Keyword.Pseudo */
    .highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
    .highlight .kt { color: #888888; font-weight: bold } /* Keyword.Type */
    .highlight .m { color: #0000DD; font-weight: bold } /* Literal.Number */
    .highlight .s { color: #dd2200 } /* Literal.String */
    .highlight .na { color: #336699 } /* Name.Attribute */
    .highlight .nb { color: #003388 } /* Name.Builtin */
    .highlight .nc { color: #bb0066; font-weight: bold } /* Name.Class */
    .highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
    .highlight .nd { color: #555555 } /* Name.Decorator */
    .highlight .ne { color: #bb0066; font-weight: bold } /* Name.Exception */
    .highlight .nf { color: #0066bb; font-weight: bold } /* Name.Function */
    .highlight .nl { color: #336699; font-style: italic } /* Name.Label */
    .highlight .nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
    .highlight .py { color: #336699; font-weight: bold } /* Name.Property */
    .highlight .nt { color: #bb0066; font-weight: bold } /* Name.Tag */
    .highlight .nv { color: #336699 } /* Name.Variable */
    .highlight .ow { color: #008800 } /* Operator.Word */
    .highlight .w { color: #bbbbbb } /* Text.Whitespace */
    .highlight .mb { color: #0000DD; font-weight: bold } /* Literal.Number.Bin */
    .highlight .mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
    .highlight .mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
    .highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
    .highlight .mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
    .highlight .sa { color: #dd2200 } /* Literal.String.Affix */
    .highlight .sb { color: #dd2200 } /* Literal.String.Backtick */
    .highlight .sc { color: #dd2200 } /* Literal.String.Char */
    .highlight .dl { color: #dd2200 } /* Literal.String.Delimiter */
    .highlight .sd { color: #dd2200; font-style: italic } /* Literal.String.Doc */
    .highlight .s2 { color: #dd2200 } /* Literal.String.Double */
    .highlight .se { color: #0044dd } /* Literal.String.Escape */
    .highlight .sh { color: #dd2200 } /* Literal.String.Heredoc */
    .highlight .si { color: #3333bb } /* Literal.String.Interpol */
    .highlight .sx { color: #22bb22 } /* Literal.String.Other */
    .highlight .sr { color: #008800 } /* Literal.String.Regex */
    .highlight .s1 { color: #dd2200 } /* Literal.String.Single */
    .highlight .ss { color: #aa6600 } /* Literal.String.Symbol */
    .highlight .bp { color: #003388 } /* Name.Builtin.Pseudo */
    .highlight .fm { color: #0066bb; font-weight: bold } /* Name.Function.Magic */
    .highlight .vc { color: #336699 } /* Name.Variable.Class */
    .highlight .vg { color: #dd7700 } /* Name.Variable.Global */
    .highlight .vi { color: #3333bb } /* Name.Variable.Instance */
    .highlight .vm { color: #336699 } /* Name.Variable.Magic */
    .highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    
    /* Dark mode syntax highlighting */
    [data-theme="dark"] .highlight .c { color: #75715e } /* Comment */
    [data-theme="dark"] .highlight .err { color: #f92672 } /* Error */
    [data-theme="dark"] .highlight .k { color: #66d9ef } /* Keyword */
    [data-theme="dark"] .highlight .l { color: #ae81ff } /* Literal */
    [data-theme="dark"] .highlight .n { color: #f8f8f2 } /* Name */
    [data-theme="dark"] .highlight .o { color: #f92672 } /* Operator */
    [data-theme="dark"] .highlight .p { color: #f8f8f2 } /* Punctuation */
    [data-theme="dark"] .highlight .cm { color: #75715e } /* Comment.Multiline */
    [data-theme="dark"] .highlight .cp { color: #75715e } /* Comment.Preproc */
    [data-theme="dark"] .highlight .c1 { color: #75715e } /* Comment.Single */
    [data-theme="dark"] .highlight .cs { color: #75715e } /* Comment.Special */
    [data-theme="dark"] .highlight .ge { font-style: italic } /* Generic.Emph */
    [data-theme="dark"] .highlight .gs { font-weight: bold } /* Generic.Strong */
    [data-theme="dark"] .highlight .kc { color: #66d9ef } /* Keyword.Constant */
    [data-theme="dark"] .highlight .kd { color: #66d9ef } /* Keyword.Declaration */
    [data-theme="dark"] .highlight .kn { color: #f92672 } /* Keyword.Namespace */
    [data-theme="dark"] .highlight .kp { color: #66d9ef } /* Keyword.Pseudo */
    [data-theme="dark"] .highlight .kr { color: #66d9ef } /* Keyword.Reserved */
    [data-theme="dark"] .highlight .kt { color: #66d9ef } /* Keyword.Type */
    [data-theme="dark"] .highlight .ld { color: #e6db74 } /* Literal.Date */
    [data-theme="dark"] .highlight .m { color: #ae81ff } /* Literal.Number */
    [data-theme="dark"] .highlight .s { color: #e6db74 } /* Literal.String */
    [data-theme="dark"] .highlight .na { color: #a6e22e } /* Name.Attribute */
    [data-theme="dark"] .highlight .nb { color: #f8f8f2 } /* Name.Builtin */
    [data-theme="dark"] .highlight .nc { color: #a6e22e } /* Name.Class */
    [data-theme="dark"] .highlight .no { color: #66d9ef } /* Name.Constant */
    [data-theme="dark"] .highlight .nd { color: #a6e22e } /* Name.Decorator */
    [data-theme="dark"] .highlight .ni { color: #f8f8f2 } /* Name.Entity */
    [data-theme="dark"] .highlight .ne { color: #a6e22e } /* Name.Exception */
    [data-theme="dark"] .highlight .nf { color: #a6e22e } /* Name.Function */
    [data-theme="dark"] .highlight .nl { color: #f8f8f2 } /* Name.Label */
    [data-theme="dark"] .highlight .nn { color: #f8f8f2 } /* Name.Namespace */
    [data-theme="dark"] .highlight .nx { color: #a6e22e } /* Name.Other */
    [data-theme="dark"] .highlight .py { color: #f8f8f2 } /* Name.Property */
    [data-theme="dark"] .highlight .nt { color: #f92672 } /* Name.Tag */
    [data-theme="dark"] .highlight .nv { color: #f8f8f2 } /* Name.Variable */
    [data-theme="dark"] .highlight .ow { color: #f92672 } /* Operator.Word */
    [data-theme="dark"] .highlight .w { color: #f8f8f2 } /* Text.Whitespace */
    [data-theme="dark"] .highlight .mf { color: #ae81ff } /* Literal.Number.Float */
    [data-theme="dark"] .highlight .mh { color: #ae81ff } /* Literal.Number.Hex */
    [data-theme="dark"] .highlight .mi { color: #ae81ff } /* Literal.Number.Integer */
    [data-theme="dark"] .highlight .mo { color: #ae81ff } /* Literal.Number.Oct */
    [data-theme="dark"] .highlight .sb { color: #e6db74 } /* Literal.String.Backtick */
    [data-theme="dark"] .highlight .sc { color: #e6db74 } /* Literal.String.Char */
    [data-theme="dark"] .highlight .sd { color: #e6db74 } /* Literal.String.Doc */
    [data-theme="dark"] .highlight .s2 { color: #e6db74 } /* Literal.String.Double */
    [data-theme="dark"] .highlight .se { color: #ae81ff } /* Literal.String.Escape */
    [data-theme="dark"] .highlight .sh { color: #e6db74 } /* Literal.String.Heredoc */
    [data-theme="dark"] .highlight .si { color: #e6db74 } /* Literal.String.Interpol */
    [data-theme="dark"] .highlight .sx { color: #e6db74 } /* Literal.String.Other */
    [data-theme="dark"] .highlight .sr { color: #e6db74 } /* Literal.String.Regex */
    [data-theme="dark"] .highlight .s1 { color: #e6db74 } /* Literal.String.Single */
    [data-theme="dark"] .highlight .ss { color: #e6db74 } /* Literal.String.Symbol */
    [data-theme="dark"] .highlight .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
    [data-theme="dark"] .highlight .vc { color: #f8f8f2 } /* Name.Variable.Class */
    [data-theme="dark"] .highlight .vg { color: #f8f8f2 } /* Name.Variable.Global */
    [data-theme="dark"] .highlight .vi { color: #f8f8f2 } /* Name.Variable.Instance */
    [data-theme="dark"] .highlight .il { color: #ae81ff } /* Literal.Number.Integer.Long */
    
    .toc-card {
        @apply card bg-base-100 shadow-xl mb-8 lg:float-right lg:ml-8 lg:w-72 sticky top-4;
    }
    
    .toc-link {
        @apply hover:text-primary transition-colors;
    }
    
    .toc-active {
        @apply font-bold text-primary;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Article Header -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h1 class="card-title text-4xl mb-4">{{ title }}</h1>
            
            {% if categories %}
            <div class="flex flex-wrap gap-2 mb-4">
                {% for category in categories %}
                <span class="badge badge-primary">{{ category }}</span>
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="text-sm opacity-70 mb-4">
                Published: {{ date }}
            </div>
            
            {% if image %}
            <figure>
                <img src="{{ image }}" alt="{{ title }}" class="w-full rounded-lg">
            </figure>
            {% endif %}
        </div>
    </div>
    
    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Table of Contents -->
        <div class="lg:w-1/4 order-2 lg:order-1">
            <div class="toc-card">
                <div class="card-body p-4">
                    <h3 class="card-title text-lg mb-2">Contents</h3>
                    <div id="toc" class="toc">
                        {{ toc | safe }}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Markdown Content -->
        <div class="lg:w-3/4 order-1 lg:order-2">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <div class="markdown-content">
                        {{ content | safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add IDs to headings if they don't have them
        document.querySelectorAll('.markdown-content h2, .markdown-content h3, .markdown-content h4, .markdown-content h5, .markdown-content h6').forEach(heading => {
            if (!heading.id) {
                heading.id = heading.textContent.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
            }
        });
        
        // ScrollSpy for TOC
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Remove active class from all links
                    document.querySelectorAll('.toc-link').forEach(link => {
                        link.classList.remove('toc-active');
                    });
                    
                    // Add active class to the corresponding link
                    const id = entry.target.getAttribute('id');
                    const activeLink = document.querySelector(`.toc-link[href="#${id}"]`);
                    if (activeLink) {
                        activeLink.classList.add('toc-active');
                    }
                }
            });
        }, { rootMargin: '-100px 0px -66% 0px', threshold: 0.1 });
        
        // Observe all headings
        document.querySelectorAll('.markdown-content h2, .markdown-content h3, .markdown-content h4, .markdown-content h5, .markdown-content h6').forEach(heading => {
            observer.observe(heading);
        });
    });
</script>
{% endblock %}